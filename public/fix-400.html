<!DOCTYPE html>
<html>
<head>
    <title>🔧 Fix 400 Bad Request - Quick Instructions</title>
    <style>
        body { font-family: system-ui; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0; }
        .step { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #2196f3; }
        .code { background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace; }
        .success { background: #e8f5e8; border-left-color: #4caf50; }
        .warning { background: #fff3e0; border-left-color: #ff9800; }
        .error { background: #ffebee; border-left-color: #f44336; }
        button { background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976d2; }
    </style>
</head>
<body>
    <div class="card">
        <h1>🔧 Fix 400 Bad Request - Quick Solution</h1>
        
        <div class="step">
            <h3>🎯 Current Issue</h3>
            <p>Your backend requires admin authentication, but we need to see the validation errors first.</p>
        </div>

        <div class="step warning">
            <h3>📍 Step 1: Disable Auth Temporarily</h3>
            <p><strong>Go to your backend:</strong> <code>../Backend/TechBirdsWebApi/Controllers/</code></p>
            <p><strong>Find:</strong> <code>AuthorsController.cs</code> or <code>AdminAuthorsController.cs</code></p>
            <p><strong>Change this line:</strong></p>
            <div class="code">
[Authorize(Roles = "Admin")]  // Comment this out
↓
// [Authorize(Roles = "Admin")]  // TEMPORARILY DISABLED
            </div>
        </div>

        <div class="step">
            <h3>🔄 Step 2: Restart Backend</h3>
            <p>Save the file and restart your backend with <code>dotnet run</code></p>
        </div>

        <div class="step success">
            <h3>🧪 Step 3: Run Validation Test</h3>
            <p>Click the button below to automatically test and find the exact validation requirements:</p>
            <button onclick="runTest()">🚀 Run Validation Test</button>
            <button onclick="runManualTest()">📋 Manual Test</button>
        </div>

        <div class="step">
            <h3>🔍 Step 4: Check Results</h3>
            <p>The test will show you exactly which fields are required and what validation rules your backend expects.</p>
        </div>

        <div class="step warning">
            <h3>⚠️ Step 5: Re-enable Auth</h3>
            <p>After testing, uncomment the [Authorize] line and restart your backend!</p>
        </div>
    </div>

    <div class="card">
        <h2>📊 Test Results</h2>
        <div id="results" style="font-family: monospace; background: #000; color: #00ff00; padding: 15px; border-radius: 5px;">
            Click "Run Validation Test" above to see results here...
        </div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': '#00ff00',
                'error': '#ff6b6b', 
                'success': '#51cf66',
                'warning': '#ffd43b'
            };
            
            resultsDiv.innerHTML += `<div style="color: ${colors[type] || '#00ff00'}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function runTest() {
            resultsDiv.innerHTML = '';
            log('🧪 Starting comprehensive validation test...', 'info');
            
            const testCases = [
                {
                    name: "Minimal (firstName, lastName only)",
                    data: { firstName: "Test", lastName: "Author" }
                },
                {
                    name: "With Email",
                    data: { firstName: "Test", lastName: "Author", email: "test@example.com" }
                },
                {
                    name: "With Status",
                    data: { firstName: "Test", lastName: "Author", email: "test1@example.com", status: "Active" }
                },
                {
                    name: "Full Frontend Data",
                    data: {
                        firstName: "John", lastName: "Doe", email: "john@example.com",
                        bio: "Test bio", specialization: "Web Development", status: "Active",
                        avatar: "", website: "", twitter: "", linkedin: ""
                    }
                }
            ];
            
            for (let i = 0; i < testCases.length; i++) {
                const testCase = testCases[i];
                log(`\\n📋 Testing: ${testCase.name}`, 'info');
                
                try {
                    const response = await fetch('/api/admin/authors', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testCase.data)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        log(`✅ SUCCESS! This data structure works!`, 'success');
                        log(`Response: ${JSON.stringify(data, null, 2)}`, 'success');
                        break;
                        
                    } else if (response.status === 401) {
                        log(`🔐 Still getting 401 - auth not disabled yet`, 'warning');
                        log(`Please make sure you commented out [Authorize] and restarted backend`, 'warning');
                        break;
                        
                    } else {
                        const errorData = await response.json();
                        log(`❌ Failed: ${response.status} ${response.statusText}`, 'error');
                        
                        if (errorData.errors) {
                            log(`🔍 Validation errors:`, 'error');
                            for (const [field, messages] of Object.entries(errorData.errors)) {
                                const msgList = Array.isArray(messages) ? messages : [messages];
                                log(`  • ${field}: ${msgList.join(', ')}`, 'error');
                            }
                        }
                    }
                    
                } catch (error) {
                    log(`❌ Network error: ${error.message}`, 'error');
                    break;
                }
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            log(`\\n🎯 Test completed! Check the results above.`, 'info');
        }

        async function runManualTest() {
            resultsDiv.innerHTML = '';
            log('📋 Running manual test...', 'info');
            
            const testData = {
                firstName: "Manual",
                lastName: "Test",
                email: `manual${Date.now()}@example.com`
            };
            
            try {
                const response = await fetch('/api/admin/authors', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                log(`Response: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                log(`Data: ${JSON.stringify(data, null, 2)}`, response.ok ? 'success' : 'error');
                
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
